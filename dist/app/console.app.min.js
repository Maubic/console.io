/**
 * Name: console.io
 * Version: 0.2.0
 * Description: Javascript Remote Web Console
 * Website: http://nkashyap.github.io/console.io/
 * Author: Nisheeth Kashyap
 * Email: nisheeth.k.kashyap@gmail.com
 * Date: 2013-09-04
*/

"undefined"==typeof window.ConsoleIO&&(window.ConsoleIO={domReady:!1,namespace:function(a){var b,c=a.split("."),d=window,e=c.length;for(b=0;e>b;b++)d=d[c[b]]=d[c[b]]||{}},ready:function(a){function b(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",b,!1),a()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",b),a())}"complete"===document.readyState&&setTimeout(a,1),document.addEventListener?(document.addEventListener("DOMContentLoaded",b,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",b),window.attachEvent("onload",a))},every:function(){return Array.prototype.every?function(a,b,c){return(a||[]).every(b,c)}:function(a,b,c){a=a||[];var d=0,e=a.length;if(e)do if(!b.call(c||a,a[d],d,a))return!1;while(++d<e);return!0}}(),forEach:function(){return Array.prototype.forEach?function(a,b,c){(a||[]).forEach(b,c)}:function(a,b,c){a=a||[];var d=0,e=a.length;if(e)do b.call(c||a,a[d],d,a);while(++d<e)}}(),queryParams:function(a){var b={};return a&&a.length>0&&(a=a.replace(/"/gim,""),a.indexOf("?")>-1&&(a=a.split("?"),b.URL=a[0],a=a[1]),this.forEach(a.split("&"),function(a){a=a.split("="),this[a[0]]=a[1]},b)),b},cookieToJSON:function(a){var b={};return this.forEach(a.split("; "),function(a){a=a.split("="),this[a[0]]=a[1]},b),b},forEachProperty:function(a,b,c){var d;for(d in a)b.call(c||a,a[d],d,a)},extend:function(a,b){return this.forEachProperty(b,function(b,c){a[c]=b}),a}}),ConsoleIO.namespace("ConsoleIO.Service.Socket"),ConsoleIO.Service.Socket={io:null,name:null,guid:null,connectionMode:null,forceReconnection:!0,forceReconnectInterval:5e3,setInterval:null,subscribed:!1,connect:function(){this.io=io.connect(window.location.origin,{secure:window.location.origin.indexOf("https")>-1,resource:(window.location.pathname.split("/").slice(0,-1).join("/")+"/socket.io").substring(1)}),this.io.on("connect",this.onConnect),this.io.on("connecting",this.onConnecting),this.io.on("reconnect",this.onReconnect),this.io.on("reconnecting",this.onReconnecting),this.io.on("disconnect",this.onDisconnect),this.io.on("connect_failed",this.onConnectFailed),this.io.on("reconnect_failed",this.onReconnectFailed),this.io.on("error",this.onError),this.io.on("user:ready",this.onReady),this.io.on("user:online",this.onOnline),this.io.on("user:offline",this.onOffline)},emit:function(a,b){this.io&&this.io.socket.connected&&(b=b||{},this.io.emit("user:"+a,b))},on:function(a,b,c){this.io.on(a,function(){b.apply(c||this,arguments)})},forceReconnect:function(){if(!this.forceReconnection||this.setInterval)return!1;var a=this;this.setInterval=window.setInterval(function(){(!a.io.socket.connected||a.io.socket.connected&&!a.subscribed)&&(console.log("forceReconnect reconnecting",a.name),a.io.socket.disconnectSync(),a.io.socket.reconnect(),window.clearInterval(a.setInterval),a.setInterval=null)},this.forceReconnectInterval)},onReady:function(a){var b=ConsoleIO.Service.Socket;window.ConsoleIO.extend(b,a),console.log("onReady",b.name),b.forceReconnect()},onOnline:function(a){var b=ConsoleIO.Service.Socket;window.ConsoleIO.extend(b,a),console.log("Online",b.name),b.forceReconnect()},onOffline:function(a){var b=ConsoleIO.Service.Socket;window.ConsoleIO.extend(b,a),console.log("Offline",b.name),b.forceReconnect()},onConnect:function(){var a=ConsoleIO.Service.Socket;console.log("Connected to the Server"),a.emit("setUp"),a.subscribed=!0,a.forceReconnect()},onConnecting:function(a){ConsoleIO.Service.Socket.connectionMode=a,console.log("Connecting to the Server")},onReconnect:function(a,b){var c=ConsoleIO.Service.Socket;console.log("Reconnected to the Server after "+b+" attempts."),c.connectionMode=a,c.forceReconnect()},onReconnecting:function(){console.log("Reconnecting to the Server")},onDisconnect:function(){console.log("Disconnected from the Server")},onConnectFailed:function(){console.warn("Failed to connect to the Server")},onReconnectFailed:function(){console.warn("Failed to reconnect to the Server")},onError:function(){console.warn("Socket Error")}},ConsoleIO.namespace("ConsoleIO.Service.DHTMLXHelper"),ConsoleIO.Service.DHTMLXHelper={populateToolbar:function(a,b){ConsoleIO.forEach(a,function(a,b){switch(a.type){case"button":this.addButton(a.id,b,a.text,a.imgEnabled,a.imgDisabled);break;case"separator":this.addSeparator("separator+"+b,b);break;case"twoState":this.addButtonTwoState(a.id,b,a.text,a.imgEnabled,a.imgDisabled),this.setItemState(a.id,!!a.pressed);break;case"select":"pagesizes"===a.opts&&(a.opts=[],ConsoleIO.forEach(ConsoleIO.Settings.pageSize.list,function(b){a.opts.push([a.id+"-"+b,"obj",b])}),a.selected=a.id+"-"+ConsoleIO.Settings.pageSize.active),this.addButtonSelect(a.id,b,a.text,a.opts,a.imgEnabled,a.imgDisabled),a.selected&&this.setListOptionSelected(a.id,a.selected);break;case"text":this.addText(a.id,b,a.text);break;case"input":this.addInput(a.id,b,a.value)}a.disabled&&this.disableItem(a.id),a.width&&this.setWidth(a.id,a.width),a.tooltip&&this.setItemToolTip(a.id,a.tooltip)},b)},elements:{},createElement:function(a){a.tag=a.tag||"div",this.elements[a.tag]||(this.elements[a.tag]=document.createElement(a.tag));var b=this.elements[a.tag].cloneNode(!1);return ConsoleIO.forEachProperty(a.attr,function(a,c){a&&b.setAttribute(c,a)}),ConsoleIO.forEachProperty(a.prop,function(a,c){a&&(b[c]=a)}),a.target&&(a.insert&&"top"===a.insert?a.target.insertBefore(b,a.target.firstElementChild||a.target.firstChild):a.target.appendChild(b)),b},stripBrackets:function(a){var b=a.length-1;return"["===a.charAt(0)&&"]"===a.charAt(b)?a.substring(1,b):a}},ConsoleIO.namespace("ConsoleIO.Model.DHTMLX"),ConsoleIO.Model.DHTMLX={ToolBarItem:{Separator:{type:"separator"},PageSize:{id:"pagesize",type:"select",text:"PageSize",imgEnabled:"pagesize.gif",tooltip:"Page Size",width:90,opts:"pagesizes"},Preview:{id:"preview",type:"button",text:"Preview",imgEnabled:"preview.gif",imgDisabled:"preview_dis.gif",tooltip:"Preview"},ScreenShot:{id:"screenShot",type:"button",text:"Capture",imgEnabled:"screenshot.png",imgDisabled:"screenshot_dis.png",tooltip:"ScreenShot"},DeviceNameLabel:{id:"deviceNameLabel",type:"text",text:"Device Name:",tooltip:"Device Name"},DeviceNameText:{id:"deviceNameText",type:"input",value:"",width:120,tooltip:"Enter Device Name"},DeviceNameSet:{id:"deviceNameSet",type:"button",imgEnabled:"go.png",tooltip:"Set Device Name"},SearchText:{id:"searchText",type:"input",value:"",width:100,tooltip:"Search Text"},Search:{id:"search",type:"button",imgEnabled:"search.gif",imgDisabled:"search_dis.gif",tooltip:"Search"},Execute:{id:"execute",type:"button",text:"Execute",imgEnabled:"execute.png",imgDisabled:"execute_dis.png",tooltip:"Execute Script"},Clear:{id:"clear",type:"button",text:"Clear",imgEnabled:"clear.gif",tooltip:"Clear"},Refresh:{id:"refresh",type:"button",text:"Refresh",imgEnabled:"refresh.gif",tooltip:"Refresh"},Reload:{id:"reload",type:"button",text:"Reload",imgEnabled:"reload.png",tooltip:"Reload Browser"},Open:{id:"open",type:"select",text:"Open",imgEnabled:"open.gif",imgDisabled:"open_dis.gif",tooltip:"Open",opts:[]},Save:{id:"save",type:"select",text:"Save",imgEnabled:"save.gif",imgDisabled:"save_dis.gif",tooltip:"Save",disabled:!0,opts:[["saveAs","obj","Save As","save_as.gif"]]},Export:{id:"export",type:"button",text:"Export",imgEnabled:"downloads.gif",tooltip:"Export"},Undo:{id:"undo",type:"button",text:"Undo",imgEnabled:"undo.gif",imgDisabled:"undo_dis.gif",tooltip:"Undo",disabled:!0},Redo:{id:"redo",type:"button",text:"Redo",imgEnabled:"redo.gif",imgDisabled:"redo_dis.gif",tooltip:"Redo",disabled:!0},SelectAll:{id:"selectAll",type:"button",text:"Select All",imgEnabled:"select_all.gif",tooltip:"Select All"},Cut:{id:"cut",type:"button",text:"Cut",imgEnabled:"cut.gif",imgDisabled:"cut_dis.gif",tooltip:"Cut"},Copy:{id:"copy",type:"button",text:"Copy",imgEnabled:"copy.gif",imgDisabled:"copy_dis.gif",tooltip:"Copy"},Paste:{id:"paste",type:"button",text:"Paste",imgEnabled:"paste.gif",imgDisabled:"paste_dis.gif",tooltip:"Paste"},Web:{id:"web",type:"twoState",text:"Web",imgEnabled:"console.gif",tooltip:"Web",pressed:!1},PlayPause:{id:"playPause",type:"twoState",text:"Pause",imgEnabled:"pause.png",tooltip:"Pause logs",pressed:!1},WordWrap:{id:"wordwrap",type:"twoState",text:"Word-Wrap",imgEnabled:"word_wrap.gif",tooltip:"Word Wrap",pressed:!1},FilterLabel:{id:"filterLabel",type:"text",text:"Filters:",tooltip:"Filter Console Logs"},Info:{id:"filter-info",type:"twoState",text:"Info",imgEnabled:"info.gif",tooltip:"Info",pressed:!1},Log:{id:"filter-log",type:"twoState",text:"Log",imgEnabled:"log.png",tooltip:"Log",pressed:!1},Warn:{id:"filter-warn",type:"twoState",text:"Warn",imgEnabled:"warn.png",tooltip:"Warn",pressed:!1},Debug:{id:"filter-debug",type:"twoState",text:"Debug",imgEnabled:"debug.gif",tooltip:"Debug",pressed:!1},Error:{id:"filter-error",type:"twoState",text:"Error",imgEnabled:"error.gif",tooltip:"Error",pressed:!1}}},ConsoleIO.namespace("ConsoleIO.View.App"),ConsoleIO.View.App=function(a,b){this.ctrl=a,this.model=b,this.layout=null,this.statusBar=null},ConsoleIO.View.App.prototype.render=function(){this.layout=new dhtmlXLayoutObject(this.model.target,this.model.type,ConsoleIO.Constant.THEMES.get("layout")),this.layout.cont.obj._offsetTop=5,this.layout.cont.obj._offsetLeft=5,this.layout.cont.obj._offsetHeight=-10,this.layout.cont.obj._offsetWidth=-10,this.layout.setSizes(),this.layout.setEffect("resize",!0),this.statusBar=this.layout.attachStatusBar(),this.offline()},ConsoleIO.View.App.prototype.getContextById=function(a){return this.layout?this.layout.cells(a):null},ConsoleIO.View.App.prototype.online=function(){var a='<img src="'+ConsoleIO.Settings.iconPath+'online.png" class="status">';this.statusBar.setText(a+this.model.status)},ConsoleIO.View.App.prototype.offline=function(){var a='<img src="'+ConsoleIO.Settings.iconPath+'offline.png" class="status">';this.statusBar.setText(a+this.model.status)},ConsoleIO.View.App.prototype.notify=function(a){console.log(a)},ConsoleIO.View.App.prototype.getContextById=function(a){return this.layout?this.layout.cells(a):null},ConsoleIO.View.App.prototype.setTitle=function(a,b){this.layout&&(this.layout.cells(a).setText(b),this.layout.setCollapsedText(a,b))},ConsoleIO.namespace("ConsoleIO.View.Device"),ConsoleIO.View.Device=function(a,b){this.ctrl=a,this.model=b,this.target=null,this.layout=null},ConsoleIO.View.Device.prototype.render=function(a){this.target=a,this.layout=this.target.attachLayout("2U")},ConsoleIO.View.Device.prototype.getContextById=function(a){return this.layout?this.layout.cells(a):null},ConsoleIO.View.Device.prototype.setTitle=function(a,b){this.layout&&(this.layout.cells(a).setText(b),this.layout.setCollapsedText(a,b))},ConsoleIO.namespace("ConsoleIO.View.Browser"),ConsoleIO.View.Browser=function(a,b){this.ctrl=a,this.model=b,this.tree=null,this.target=null,this.toolbar=null},ConsoleIO.View.Browser.prototype.render=function(a){var b=this;this.target=a,this.target.setWidth(this.model.width),this.target.setHeight(this.model.height),this.toolbar=this.target.attachToolbar(),this.toolbar.setIconsPath(ConsoleIO.Settings.iconPath),this.toolbar.attachEvent("onClick",function(a){this.onButtonClick(a)},this.ctrl),ConsoleIO.Service.DHTMLXHelper.populateToolbar(this.model.toolbar,this.toolbar),this.tree=this.target.attachTree(),this.tree.setImagePath(ConsoleIO.Constant.IMAGE_URL.get("tree")),this.tree.setIconPath(ConsoleIO.Settings.iconPath),this.tree.enableHighlighting(!0),this.tree.enableTreeImages(!0),this.tree.enableTreeLines(!0),this.tree.enableIEImageFix(!0),this.tree.attachEvent("onDblClick",function(a){b.tree.hasChildren(a)||b.ctrl.subscribe(a)})},ConsoleIO.View.Browser.prototype.add=function(a,b,c,d){this.tree.getParentId(a)||(d?this.tree.insertNewItem(c,a,b,0,d,d,d):this.tree.insertNewItem(c,a,b))},ConsoleIO.View.Browser.prototype.addOrUpdate=function(a,b,c,d){this.tree.getParentId(a)&&this.tree.deleteItem(a),d?this.tree.insertNewItem(c,a,b,0,d,d,d):this.tree.insertNewItem(c,a,b)},ConsoleIO.View.Browser.prototype.setIcon=function(a,b){this.tree.setItemImage(a,b)},ConsoleIO.View.Browser.prototype.deleteItem=function(a){this.tree.deleteItem(a)},ConsoleIO.namespace("ConsoleIO.View.Device.Console"),ConsoleIO.View.Device.Console=function(a,b){this.ctrl=a,this.model=b,this.target=null,this.tab=null,this.toolbar=null,this.id=[this.model.name,this.model.guid].join("-"),this.container=ConsoleIO.Service.DHTMLXHelper.createElement({attr:{id:"console-"+this.id}})},ConsoleIO.View.Device.Console.prototype.render=function(a){this.target=a,this.target.addTab(this.id,this.model.name),this.target.setContent(this.id,this.container),this.tab=this.target.cells(this.id),this.toolbar=this.tab.attachToolbar(),this.toolbar.setIconsPath(ConsoleIO.Settings.iconPath),this.toolbar.attachEvent("onClick",function(a){this.onButtonClick(a)},this.ctrl),this.toolbar.attachEvent("onStateChange",function(a,b){this.onButtonClick(a,b)},this.ctrl),this.toolbar.attachEvent("onEnter",function(a,b){this.applySearch(b)},this.ctrl),ConsoleIO.Service.DHTMLXHelper.populateToolbar(this.model.toolbar,this.toolbar)},ConsoleIO.View.Device.Console.prototype.getElementData=function(a){a.message=unescape(a.message);var b,c,d="code",e=a.type,f=ConsoleIO.Service.DHTMLXHelper.stripBrackets(a.message);if("assert"===a.type){var g=ConsoleIO.Service.DHTMLXHelper.stripBrackets(f).split(",");"true"!==g[0].toLowerCase()&&(e="assert-failed")}if(f=f.replace(/%20/gim," "),f.indexOf("{")>-1&&f.indexOf("}")>-1&&(d="pre"),c=prettyPrintOne(f),a.stack){var h=a.stack.split(",").join("\n").replace(/"/gim,"").replace(/%20/gim," ");b=ConsoleIO.Service.DHTMLXHelper.stripBrackets(h),c+="\n"+prettyPrintOne(b)}return["assert","dir","dirxml","error","trace"].indexOf(a.type)>-1&&(d="pre"),{tag:d,className:"console type-"+e,message:c||"."}},ConsoleIO.View.Device.Console.prototype.add=function(a){var b=this.getElementData(a);ConsoleIO.Service.DHTMLXHelper.createElement({tag:b.tag,attr:{"class":b.className},prop:{innerHTML:b.message},target:this.container,insert:"top"}),this.removeOverflowElement()},ConsoleIO.View.Device.Console.prototype.addBatch=function(a){if(a.length>0){var b=document.createDocumentFragment();ConsoleIO.forEach(a,function(a){var c=this.getElementData(a);ConsoleIO.Service.DHTMLXHelper.createElement({tag:c.tag,attr:{"class":c.className},prop:{innerHTML:c.message},target:b,insert:"bottom"})},this),this.container.insertBefore(b,this.container.firstElementChild||this.container.firstChild),this.removeOverflowElement()}},ConsoleIO.View.Device.Console.prototype.getHTML=function(){return this.container.innerHTML},ConsoleIO.View.Device.Console.prototype.getValue=function(a){return this.toolbar.getValue(a)},ConsoleIO.View.Device.Console.prototype.clear=function(){for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)},ConsoleIO.View.Device.Console.prototype.removeOverflowElement=function(){for(var a=this.container.childElementCount||this.container.children.length;a>ConsoleIO.Settings.pageSize.active;)this.container.removeChild(this.container.lastElementChild||this.container.lastChild),a--},ConsoleIO.View.Device.Console.prototype.setItemState=function(a,b){this.toolbar&&this.toolbar.setItemState(a,b)},ConsoleIO.View.Device.Console.prototype.setValue=function(a,b){this.toolbar&&this.toolbar.setValue(a,b)},ConsoleIO.namespace("ConsoleIO.View.Device.Explorer"),ConsoleIO.View.Device.Explorer=function(a,b){this.ctrl=a,this.model=b,this.tree=null,this.target=null,this.toolbar=null},ConsoleIO.View.Device.Explorer.prototype.render=function(a){var b=this;this.target=a,this.target.setWidth(this.model.width),this.toolbar=this.target.attachToolbar(),this.toolbar.setIconsPath(ConsoleIO.Settings.iconPath),this.toolbar.attachEvent("onClick",function(a){this.onButtonClick(a)},this.ctrl),ConsoleIO.Service.DHTMLXHelper.populateToolbar(this.model.toolbar,this.toolbar),this.tree=this.target.attachTree(),this.tree.setImagePath(ConsoleIO.Constant.IMAGE_URL.get("tree")),this.tree.setIconPath(ConsoleIO.Settings.iconPath),this.tree.enableHighlighting(!0),this.tree.enableTreeImages(!0),this.tree.enableTreeLines(!0),this.tree.enableIEImageFix(!0),this.tree.attachEvent("onDblClick",function(a){b.tree.hasChildren(a)||this.viewFile(a)},this.ctrl)},ConsoleIO.View.Device.Explorer.prototype.add=function(a,b,c,d){d?this.tree.insertNewItem(c,a,b,0,d,d,d):this.tree.insertNewItem(c,a,b)},ConsoleIO.View.Device.Explorer.prototype.setIcon=function(a,b){this.tree.setItemImage(a,b)},ConsoleIO.View.Device.Explorer.prototype.deleteItem=function(a){this.tree.deleteItem(a)},ConsoleIO.namespace("ConsoleIO.View.Device.Panel"),ConsoleIO.View.Device.Panel=function(a,b){this.ctrl=a,this.model=b,this.target=null,this.tabs=null},ConsoleIO.View.Device.Panel.prototype.render=function(a){this.target=a,this.tabs=this.target.attachTabbar(),this.tabs.setImagePath(ConsoleIO.Constant.IMAGE_URL.get("tab")),this.tabs.attachEvent("onTabClick",function(a){this.onTabClick(a)},this.ctrl)},ConsoleIO.namespace("ConsoleIO.View.Device.Preview"),ConsoleIO.View.Device.Preview=function(a,b){this.ctrl=a,this.model=b,this.target=null,this.toolbar=null,this.tab=null,this.dhxWins=null,this.previewFrame=null,this.image=null,this.id=[this.model.name,this.model.guid].join("-")},ConsoleIO.View.Device.Preview.prototype.render=function(a){this.target=a,this.target.addTab(this.id,this.model.name),this.tab=this.target.cells(this.id),this.toolbar=this.tab.attachToolbar(),this.toolbar.setIconsPath(ConsoleIO.Settings.iconPath),this.toolbar.attachEvent("onClick",function(a){this.onButtonClick(a)},this.ctrl),this.toolbar.attachEvent("onStateChange",function(a,b){this.onButtonClick(a,b)},this.ctrl),ConsoleIO.Service.DHTMLXHelper.populateToolbar(this.model.toolbar,this.toolbar),this.previewFrame=ConsoleIO.Service.DHTMLXHelper.createElement({tag:"iframe",attr:{height:"100%",width:"100%"},target:document.body}),this.image=ConsoleIO.Service.DHTMLXHelper.createElement({tag:"img",target:document.body}),this.dhxWins=new dhtmlXWindows,this.dhxWins.enableAutoViewport(!0),this.dhxWins.attachViewportTo(document.body),this.dhxWins.setSkin(ConsoleIO.Constant.THEMES.get("win")),this.dhxWins.setImagePath(ConsoleIO.Constant.IMAGE_URL.get("win"))},ConsoleIO.View.Device.Preview.prototype.toggleButton=function(a,b){this.toolbar&&(b?this.toolbar.enableItem(a):this.toolbar.disableItem(a))},ConsoleIO.View.Device.Preview.prototype.preview=function(a){if(this.dhxWins){this.previewFrame.src="data:text/html,"+escape(a.content);var b=this.dhxWins.createWindow("preview",0,0,900,700);b.setText("Preview"),b.button("park").hide(),b.keepInViewport(!0),b.setModal(!0),b.centerOnScreen(),b.button("close").attachEvent("onClick",function(){b.detachObject(this.previewFrame),b.close()},this),b.attachObject(this.previewFrame)}},ConsoleIO.View.Device.Preview.prototype.screenShot=function(a){if(this.dhxWins)if(a.screen){this.image.src=a.screen;var b=this.dhxWins.createWindow("screen",0,0,900,700);b.setText("Capture"),b.button("park").hide(),b.keepInViewport(!0),b.setModal(!0),b.centerOnScreen(),b.button("close").attachEvent("onClick",function(){b.detachObject(this.image),b.close()},this),b.attachObject(this.image)}else alert("Sorry!, Console.IO was unable to capture screen. Check console for more details.")},ConsoleIO.namespace("ConsoleIO.View.Device.Source"),ConsoleIO.View.Device.Source=function(a,b){this.ctrl=a,this.model=b,this.target=null,this.toolbar=null,this.tab=null,this.id=[this.model.name,this.model.guid].join("-")},ConsoleIO.View.Device.Source.prototype.render=function(a){this.target=a,this.target.addTab(this.id,this.model.name),this.tab=this.target.cells(this.id),this.toolbar=this.tab.attachToolbar(),this.toolbar.setIconsPath(ConsoleIO.Settings.iconPath),this.toolbar.attachEvent("onClick",function(a){this.onButtonClick(a)},this.ctrl),this.toolbar.attachEvent("onStateChange",function(a,b){this.onButtonClick(a,b)},this.ctrl),ConsoleIO.Service.DHTMLXHelper.populateToolbar(this.model.toolbar,this.toolbar)},ConsoleIO.View.Device.Source.prototype.setActive=function(){this.target.setTabActive(this.id)},ConsoleIO.namespace("ConsoleIO.View.Device.Status"),ConsoleIO.View.Device.Status=function(a,b){this.ctrl=a,this.model=b,this.target=null,this.toolbar=null,this.tab=null,this.id=[this.model.name,this.model.guid].join("-"),this.container=ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"status-contents",id:this.id}}),this.labels={}},ConsoleIO.View.Device.Status.prototype.render=function(a){this.target=a,this.target.addTab(this.id,this.model.name),this.target.setContent(this.id,this.container),this.target.setTabActive(this.id),this.tab=this.target.cells(this.id),this.toolbar=this.tab.attachToolbar(),this.toolbar.setIconsPath(ConsoleIO.Settings.iconPath),this.toolbar.attachEvent("onClick",function(a){this.onButtonClick(a)},this.ctrl),this.toolbar.attachEvent("onStateChange",function(a,b){this.onButtonClick(a,b)},this.ctrl),ConsoleIO.Service.DHTMLXHelper.populateToolbar(this.model.toolbar,this.toolbar)},ConsoleIO.View.Device.Status.prototype.clear=function(){for(;this.container.firstChild;)this.container.removeChild(this.container.firstChild)},ConsoleIO.View.Device.Status.prototype.addLabel=function(a){var b=this.id+"-"+a,c=ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"label"},prop:{id:b},target:this.container});ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"title"},prop:{innerHTML:a},target:c}),this.labels[b]=c},ConsoleIO.View.Device.Status.prototype.add=function(a,b,c){var d=ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"property"},target:this.labels[this.id+"-"+c]});ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"name"},prop:{innerHTML:a},target:d});var e=ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"value"},target:d});"string"==typeof b?ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"valueText"},prop:{innerHTML:b},target:e}):ConsoleIO.forEachProperty(b,function(a,b){ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"valueList"},prop:{innerHTML:b+": "+a},target:e})},this)},ConsoleIO.View.Device.Status.prototype.getValue=function(a){return this.toolbar.getValue(a)},ConsoleIO.View.Device.Status.prototype.setItemState=function(a,b){this.toolbar&&this.toolbar.setItemState(a,b)},ConsoleIO.namespace("ConsoleIO.View.Editor"),ConsoleIO.View.Editor=function(a,b){this.ctrl=a,this.model=b,this.container=null,this.textArea=null,this.target=null,this.toolbar=null,this.createElements()},ConsoleIO.View.Editor.prototype.render=function(a){this.target=a,this.target.attachObject(this.container),this.model.toolbar&&(this.toolbar=this.target.attachToolbar(),this.toolbar.setIconsPath(ConsoleIO.Settings.iconPath),this.toolbar.attachEvent("onClick",function(a){this.onButtonClick(a)},this.ctrl),this.toolbar.attachEvent("onStateChange",function(a,b){this.onButtonClick(a,b)},this.ctrl),ConsoleIO.Service.DHTMLXHelper.populateToolbar(this.model.toolbar,this.toolbar))},ConsoleIO.View.Editor.prototype.listScripts=function(a){var b=this;this.toolbar.forEachListOption("open",function(a){b.toolbar.removeListOption("open",a)}),ConsoleIO.forEach(a,function(a,c){b.toolbar.addListOption("open","script-"+a,c,"button",a,ConsoleIO.Constant.ICONS.JAVASCRIPT)},this)},ConsoleIO.View.Editor.prototype.addScript=function(a){var b="script-"+a.name,c=this.toolbar.getAllListOptions("open").length;this.toolbar.removeListOption("open",b),this.toolbar.addListOption("open",b,c,"button",a.name,ConsoleIO.Constant.ICONS.JAVASCRIPT)},ConsoleIO.View.Editor.prototype.createElements=function(){this.container=ConsoleIO.Service.DHTMLXHelper.createElement({attr:{"class":"editor"},target:document.body}),this.textArea=ConsoleIO.Service.DHTMLXHelper.createElement({tag:"textarea",attr:{placeholder:this.model.placeholder},target:this.container})},ConsoleIO.View.Editor.prototype.toggleButton=function(a,b){this.toolbar&&(b?this.toolbar.enableItem(a):this.toolbar.disableItem(a))},ConsoleIO.namespace("ConsoleIO.View.Manager"),ConsoleIO.View.Manager=function(a,b){this.ctrl=a,this.model=b,this.target=null,this.tabs=null},ConsoleIO.View.Manager.prototype.render=function(a){this.target=a,this.tabs=this.target.attachTabbar(),this.tabs.setImagePath(ConsoleIO.Constant.IMAGE_URL.get("tab")),this.tabs.enableTabCloseButton(!0),this.tabs.attachEvent("onTabClose",function(a){this.close(a)},this.ctrl),this.tabs.attachEvent("onTabClick",function(a){this.onTabClick(a)},this.ctrl)},ConsoleIO.View.Manager.prototype.add=function(a,b,c){this.tabs.addTab(a,b),c&&this.tabs.setTabActive(a)},ConsoleIO.View.Manager.prototype.update=function(a,b){this.tabs.setLabel(a,b)},ConsoleIO.View.Manager.prototype.remove=function(a){this.tabs.removeTab(a)},ConsoleIO.View.Manager.prototype.getContextById=function(a){return this.tabs?this.tabs.cells(a):null},ConsoleIO.View.Manager.prototype.setActive=function(a){this.tabs.setTabActive(a)},ConsoleIO.namespace("ConsoleIO.App"),ConsoleIO.App=function(){this.context={browser:"a",editor:"b",manager:"c"},this.view=new ConsoleIO.View.App(this,{target:document.body,type:"3U",status:"<a style='float:left;' target='_blank' href='http://nkashyap.github.io/console.io/'>Welcome to Console.IO</a><span style='float:right;'>Author: Nisheeth Kashyap, Email: nisheeth.k.kashyap@gmail.com</span>"}),this.browser=new ConsoleIO.App.Browser(this,{title:"Device List",contextId:"browser",width:200,height:250,toolbar:[ConsoleIO.Model.DHTMLX.ToolBarItem.Refresh]}),this.editor=new ConsoleIO.App.Editor(this,{contextId:"editor",title:"Editor",placeholder:"Write javascript code to execute on remote client",codeMirror:{mode:"javascript",readOnly:!1},toolbar:[ConsoleIO.Model.DHTMLX.ToolBarItem.Open,ConsoleIO.Model.DHTMLX.ToolBarItem.Save,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.Cut,ConsoleIO.Model.DHTMLX.ToolBarItem.Copy,ConsoleIO.Model.DHTMLX.ToolBarItem.Paste,ConsoleIO.Model.DHTMLX.ToolBarItem.SelectAll,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.Undo,ConsoleIO.Model.DHTMLX.ToolBarItem.Redo,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.Clear,ConsoleIO.Model.DHTMLX.ToolBarItem.WordWrap,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.Execute]}),this.manager=new ConsoleIO.App.Manager(this,{title:"Manager",contextId:"manager"}),ConsoleIO.Service.Socket.on("connect",this.onConnect,this),ConsoleIO.Service.Socket.on("disconnect",this.onDisconnect,this),ConsoleIO.Service.Socket.on("user:error",this.notify,this),ConsoleIO.Service.Socket.on("user:listScripts",this.listScripts,this),ConsoleIO.Service.Socket.on("user:scriptContent",this.add,this),ConsoleIO.Service.Socket.on("user:scriptSaved",this.scriptSaved,this)},ConsoleIO.App.prototype.render=function(){this.view.render(),this.browser.render(this.view.getContextById(this.context.browser)),this.editor.render(this.view.getContextById(this.context.editor)),this.manager.render(this.view.getContextById(this.context.manager))},ConsoleIO.App.prototype.setTitle=function(a,b){this.view.setTitle(this.context[a],b)},ConsoleIO.App.prototype.listScripts=function(a){this.editor.listScripts(a)},ConsoleIO.App.prototype.scriptSaved=function(a){this.editor.fileName=a.name,this.editor.addScript(a)},ConsoleIO.App.prototype.add=function(a){this.editor.add(a)},ConsoleIO.App.prototype.onConnect=function(){this.view.online()},ConsoleIO.App.prototype.onDisconnect=function(){this.view.offline()},ConsoleIO.App.prototype.notify=function(){this.view.notify(arguments)},ConsoleIO.App.prototype.getActiveDeviceGuid=function(){return this.manager.getActiveDeviceGuid()},ConsoleIO.namespace("ConsoleIO.App.Device"),ConsoleIO.App.Device=function(a,b){this.parent=a,this.model=b,this.context={explorer:"a",panel:"b"},this.view=new ConsoleIO.View.Device(this,this.model),this.explorer=new ConsoleIO.App.Device.Explorer(this,{name:this.model.name,guid:this.model.guid,title:"Files",contextId:"explorer",width:200,toolbar:[ConsoleIO.Model.DHTMLX.ToolBarItem.Refresh]}),this.panel=new ConsoleIO.App.Device.Panel(this,this.model)},ConsoleIO.App.Device.prototype.render=function(a){this.view.render(a),this.explorer.render(this.view.getContextById(this.context.explorer)),this.panel.render(this.view.getContextById(this.context.panel))},ConsoleIO.App.Device.prototype.update=function(a){this.parent.update(a)},ConsoleIO.App.Device.prototype.setTitle=function(a,b){this.view.setTitle(this.context[a],b)},ConsoleIO.App.Device.prototype.activate=function(a){this.panel.activate(a)},ConsoleIO.namespace("ConsoleIO.App.Browser"),ConsoleIO.App.Browser=function(a,b){this.parent=a,this.model=b,this.store={platform:[],manufacture:[],browser:[],version:[],offline:[],subscribed:[]},this.view=new ConsoleIO.View.Browser(this,this.model),ConsoleIO.Service.Socket.on("user:registeredDevice",this.add,this),ConsoleIO.Service.Socket.on("user:subscribed",this.subscribed,this),ConsoleIO.Service.Socket.on("user:unSubscribed",this.unSubscribed,this),ConsoleIO.Service.Socket.on("device:registered",this.add,this),ConsoleIO.Service.Socket.on("device:online",this.online,this),ConsoleIO.Service.Socket.on("device:offline",this.offline,this)},ConsoleIO.App.Browser.prototype.online=function(a){var b=this.store.offline.indexOf(a.guid);b>-1&&this.store.offline.splice(b,1),this.isSubscribed(a.guid)?this.subscribed(a):this.view.setIcon(a.guid,ConsoleIO.Constant.ICONS.ONLINE)},ConsoleIO.App.Browser.prototype.offline=function(a){-1===this.store.offline.indexOf(a.guid)&&this.store.offline.push(a.guid),this.view.setIcon(a.guid,ConsoleIO.Constant.ICONS.OFFLINE)},ConsoleIO.App.Browser.prototype.isSubscribed=function(a){return this.store.subscribed.indexOf(a)>-1},ConsoleIO.App.Browser.prototype.subscribed=function(a){this.isSubscribed(a.guid)||this.store.subscribed.push(a.guid),this.view.setIcon(a.guid,ConsoleIO.Constant.ICONS.SUBSCRIBE)},ConsoleIO.App.Browser.prototype.unSubscribed=function(a){var b=this.store.subscribed.indexOf(a.guid);b>-1&&(this.store.subscribed.splice(b,1),-1===this.store.offline.indexOf(a.guid)?this.online(a):this.offline(a))},ConsoleIO.App.Browser.prototype.add=function(a){var b=a.platform+"-"+a.manufacture,c=b+"-"+a.browser,d=c+"-"+a.version;-1===this.store.platform.indexOf(a.platform)&&(this.store.platform.push(a.platform),this.view.add(a.platform,a.platform,0,ConsoleIO.Constant.ICONS[a.platform.toUpperCase()]||ConsoleIO.Constant.ICONS.UNKNOWN)),-1===this.store.manufacture.indexOf(b)&&(this.store.manufacture.push(b),this.view.add(b,a.manufacture,a.platform,ConsoleIO.Constant.ICONS[a.manufacture.toUpperCase()]||ConsoleIO.Constant.ICONS.UNKNOWN)),-1===this.store.browser.indexOf(c)&&(this.store.browser.push(c),this.view.add(c,a.browser,b,ConsoleIO.Constant.ICONS[a.browser.toUpperCase()]||ConsoleIO.Constant.ICONS.UNKNOWN)),-1===this.store.version.indexOf(d)&&(this.store.version.push(d),this.view.add(d,a.version,c,ConsoleIO.Constant.ICONS.VERSION)),this.view.addOrUpdate(a.guid,a.name.indexOf("|")>-1?a.browser:a.name,d),a.subscribed&&a.online?this.subscribed(a):a.online?this.online(a):this.offline(a)},ConsoleIO.App.Browser.prototype.render=function(a){this.parent.setTitle(this.model.contextId||this.model.guid,this.model.title),this.view.render(a)},ConsoleIO.App.Browser.prototype.refresh=function(){ConsoleIO.forEach(this.store.platform,function(a){this.deleteItem(a)},this.view),this.store={platform:[],manufacture:[],browser:[],version:[],offline:[],subscribed:[]},ConsoleIO.Service.Socket.emit("refreshRegisteredDeviceList")},ConsoleIO.App.Browser.prototype.onButtonClick=function(a){"refresh"===a&&this.refresh()},ConsoleIO.App.Browser.prototype.subscribe=function(a){this.isSubscribed(a)||ConsoleIO.Service.Socket.emit("subscribe",a)},ConsoleIO.namespace("ConsoleIO.App.Device.Console"),ConsoleIO.App.Device.Console=function(a,b){this.parent=a,this.model=b,this.active=!0,this.paused=!1,this.filters=[],this.searchRegex=null,this.store={added:[],queue:[]};
var c=this.model.web.config;"undefined"!=typeof c.pageSize&&(ConsoleIO.Settings.pageSize.active=c.pageSize),"undefined"!=typeof c.paused&&(this.paused=this.model.web.config.paused),"undefined"!=typeof c.filters&&(this.filters=this.model.web.config.filters),"undefined"!=typeof c.search&&(this.searchRegex=this.model.web.config.search),this.view=new ConsoleIO.View.Device.Console(this,{name:"Console",guid:this.model.guid,toolbar:[ConsoleIO.Model.DHTMLX.ToolBarItem.Reload,ConsoleIO.Model.DHTMLX.ToolBarItem.PlayPause,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.Clear,ConsoleIO.Model.DHTMLX.ToolBarItem.Export,ConsoleIO.Model.DHTMLX.ToolBarItem.PageSize,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.SearchText,ConsoleIO.Model.DHTMLX.ToolBarItem.Search,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.FilterLabel,ConsoleIO.Model.DHTMLX.ToolBarItem.Info,ConsoleIO.Model.DHTMLX.ToolBarItem.Log,ConsoleIO.Model.DHTMLX.ToolBarItem.Warn,ConsoleIO.Model.DHTMLX.ToolBarItem.Debug,ConsoleIO.Model.DHTMLX.ToolBarItem.Error]}),ConsoleIO.Service.Socket.on("device:console:"+this.model.guid,this.add,this)},ConsoleIO.App.Device.Console.prototype.render=function(a){this.view.render(a),this.view.setItemState("playPause",this.paused),this.view.setValue("searchText",this.searchRegex),this.searchRegex&&this.applySearch(this.searchRegex),ConsoleIO.forEach(this.filters,function(a){this.view.setItemState("filter-"+a,!0)},this)},ConsoleIO.App.Device.Console.prototype.activate=function(a){this.active=a,this.addBatch()},ConsoleIO.App.Device.Console.prototype.getData=function(a){var b=0,c=[];return a.length>0&&ConsoleIO.every([].concat(a).reverse(),function(a){return this.isFiltered(a)&&this.isSearchFiltered(a)&&(c.push(a),b++),ConsoleIO.Settings.pageSize.active>b},this),c},ConsoleIO.App.Device.Console.prototype.add=function(a){if(this.active&&!this.paused){if(this.store.added.push(a),!this.isFiltered(a)||!this.isSearchFiltered(a))return!1;this.view.add(a)}else this.store.queue.push(a)},ConsoleIO.App.Device.Console.prototype.addBatch=function(){this.active&&!this.paused&&(this.view.addBatch(this.getData(this.store.queue)),this.store.added=this.store.added.concat(this.store.queue),this.store.queue=[])},ConsoleIO.App.Device.Console.prototype.applySearch=function(a){this.searchRegex="undefined"==typeof a?this.view.getValue("searchText"):a,this.searchRegex&&(this.searchRegex="\\"!==this.searchRegex[0]?new RegExp("\\b"+this.searchRegex,"img"):new RegExp(this.searchRegex,"img")),this.view.clear(),this.view.addBatch(this.getData(this.store.added))},ConsoleIO.App.Device.Console.prototype.isSearchFiltered=function(a){return this.searchRegex?a.message.search(this.searchRegex)>-1:!0},ConsoleIO.App.Device.Console.prototype.isFiltered=function(a){return 0===this.filters.length||this.filters.length>0&&this.filters.indexOf(a.type)>-1},ConsoleIO.App.Device.Console.prototype.onPageSizeChanged=function(a){ConsoleIO.Settings.pageSize.active=a.split("-")[1],this.view.clear(),this.view.addBatch(this.getData(this.store.added))},ConsoleIO.App.Device.Console.prototype.onFilterChanged=function(a,b){var c=a.split("-")[1],d=this.filters.indexOf(c);b&&-1===d?this.filters.push(c):d>-1&&this.filters.splice(d,1),this.view.clear(),this.view.addBatch(this.getData(this.store.added))},ConsoleIO.App.Device.Console.prototype.onButtonClick=function(a,b){if(!this.parent.onButtonClick(this,a,b))if(0===a.indexOf("pagesize-"))this.onPageSizeChanged(a),this.notify();else if(0===a.indexOf("filter-"))this.onFilterChanged(a,b),this.notify();else switch(a){case"playPause":this.paused=b,this.addBatch(),this.notify();break;case"clear":this.view.clear(),this.notify(!0);break;case"search":this.applySearch(),this.notify();break;case"export":ConsoleIO.Service.Socket.emit("exportHTML",{guid:this.model.guid,name:this.model.name,content:this.view.getHTML()})}},ConsoleIO.App.Device.Console.prototype.notify=function(a){ConsoleIO.Service.Socket.emit("webControl",{guid:this.model.guid,pageSize:ConsoleIO.Settings.pageSize.active,filters:this.filters,search:this.view.getValue("searchText"),paused:this.paused,clear:!!a})},ConsoleIO.namespace("ConsoleIO.App.Device.Explorer"),ConsoleIO.App.Device.Explorer=function(a,b){this.parent=a,this.model=b,this.store={folder:[],files:[]},this.view=new ConsoleIO.View.Device.Explorer(this,this.model),ConsoleIO.Service.Socket.on("device:files:"+this.model.guid,this.add,this),this.refresh()},ConsoleIO.App.Device.Explorer.prototype.render=function(a){this.parent.setTitle(this.model.contextId||this.model.guid,this.model.title),this.view.render(a)},ConsoleIO.App.Device.Explorer.prototype.getParentId=function(a,b){var c=a.indexOf(b);return c>0?a.slice(0,c).join("|"):0},ConsoleIO.App.Device.Explorer.prototype.add=function(a){ConsoleIO.forEach(a.files,function(a){a=a.split("?")[0];var b=new RegExp("((http|https)://)?([^/]+)","img"),c=a.match(b);ConsoleIO.forEach(c,function(a){var b=a.indexOf(".js")>-1,d=a.indexOf(".css")>-1,e=a.indexOf("http")>-1,f=this.getParentId(c,a),g=f?f+"|"+a:a;b||d?-1===this.store.files.indexOf(g)&&(this.store.files.push(g),this.view.add(g,a,f,ConsoleIO.Constant.ICONS[b?"JAVASCRIPT":d?"STYLESHEET":"FILE"])):-1===this.store.folder.indexOf(g)&&(this.store.folder.push(g),this.view.add(g,a,f,ConsoleIO.Constant.ICONS[e?"WEB":"FOLDEROPEN"]))},this)},this)},ConsoleIO.App.Device.Explorer.prototype.refresh=function(){ConsoleIO.forEach(this.store.folder,function(a){this.deleteItem(a)},this.view),ConsoleIO.forEach(this.store.files,function(a){this.deleteItem(a)},this.view),this.store={folder:[],files:[]},ConsoleIO.Service.Socket.emit("reloadFiles",{guid:this.model.guid})},ConsoleIO.App.Device.Explorer.prototype.onButtonClick=function(a){"refresh"===a&&this.refresh()},ConsoleIO.App.Device.Explorer.prototype.viewFile=function(a){ConsoleIO.Service.Socket.emit("fileSource",{guid:this.model.guid,url:(-1===a.indexOf("http")?"/":"")+a.replace(/[|]/gim,"/")})},ConsoleIO.namespace("ConsoleIO.App.Device.Panel"),ConsoleIO.App.Device.Panel=function(a,b){this.parent=a,this.model=b,this.activeTab=null,this.view=new ConsoleIO.View.Device.Panel(this,this.model),this.console=new ConsoleIO.App.Device.Console(this,this.model),this.source=new ConsoleIO.App.Device.Source(this,this.model),this.preview=new ConsoleIO.App.Device.Preview(this,this.model),this.status=new ConsoleIO.App.Device.Status(this,this.model)},ConsoleIO.App.Device.Panel.prototype.render=function(a){this.view.render(a),this.status.render(this.view.tabs),this.source.render(this.view.tabs),this.preview.render(this.view.tabs),this.console.render(this.view.tabs)},ConsoleIO.App.Device.Panel.prototype.update=function(a){this.parent.update(a)},ConsoleIO.App.Device.Panel.prototype.onTabClick=function(a){var b=a.split("-")[0].toLowerCase();this.activeTab&&this.activeTab===b||(this.activeTab&&this[this.activeTab].activate(!1),this.activeTab=b,this[this.activeTab].activate(!0))},ConsoleIO.App.Device.Panel.prototype.activate=function(a){a?this.activeTab&&this[this.activeTab].activate(a):(this.status.activate(a),this.source.activate(a),this.preview.activate(a),this.console.activate(a))},ConsoleIO.App.Device.Panel.prototype.onButtonClick=function(a,b,c){var d=!1;switch(b){case"reload":ConsoleIO.Service.Socket.emit("reloadDevice",{guid:this.model.guid}),d=!0;break;case"refresh":a.refresh(),d=!0;break;case"wordwrap":a.editor.setOption("lineWrapping",c),d=!0;break;case"selectAll":a.editor.selectAll(),d=!0;break;case"copy":a.editor.copy(),d=!0}return d},ConsoleIO.namespace("ConsoleIO.App.Device.Preview"),ConsoleIO.App.Device.Preview=function(a,b){this.parent=a,this.model=b,this.view=new ConsoleIO.View.Device.Preview(this,{name:"Preview",guid:this.model.guid,toolbar:[ConsoleIO.Model.DHTMLX.ToolBarItem.Refresh,ConsoleIO.Model.DHTMLX.ToolBarItem.Reload,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.WordWrap,ConsoleIO.Model.DHTMLX.ToolBarItem.SelectAll,ConsoleIO.Model.DHTMLX.ToolBarItem.Copy,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.Preview,ConsoleIO.Model.DHTMLX.ToolBarItem.ScreenShot]}),this.editor=new ConsoleIO.App.Editor(this,{}),ConsoleIO.Service.Socket.on("device:content:"+this.model.guid,this.add,this),ConsoleIO.Service.Socket.on("device:previewContent:"+this.model.guid,this.preview,this),ConsoleIO.Service.Socket.on("device:screenShot:"+this.model.guid,this.screenShot,this)},ConsoleIO.App.Device.Preview.prototype.render=function(a){this.view.render(a),this.editor.render(this.view.tab)},ConsoleIO.App.Device.Preview.prototype.activate=function(a){a&&ConsoleIO.Settings.reloadTabContentWhenActivated&&this.refresh()},ConsoleIO.App.Device.Preview.prototype.add=function(a){this.editor.add(a)},ConsoleIO.App.Device.Preview.prototype.preview=function(a){this.view.toggleButton("preview",!0),this.view.preview(a)},ConsoleIO.App.Device.Preview.prototype.screenShot=function(a){this.view.toggleButton("screenShot",!0),this.view.screenShot(a)},ConsoleIO.App.Device.Preview.prototype.refresh=function(){ConsoleIO.Service.Socket.emit("reloadHTML",{guid:this.model.guid})},ConsoleIO.App.Device.Preview.prototype.onButtonClick=function(a,b){if(!this.parent.onButtonClick(this,a,b))switch(a){case"preview":this.view.toggleButton("preview",!1),ConsoleIO.Service.Socket.emit("previewHTML",{guid:this.model.guid});break;case"screenShot":this.view.toggleButton("screenShot",!1),ConsoleIO.Service.Socket.emit("captureScreen",{guid:this.model.guid});var c=this;setTimeout(function(){c.view.toggleButton("screenShot",!0)},1e4)}},ConsoleIO.namespace("ConsoleIO.App.Device.Source"),ConsoleIO.App.Device.Source=function(a,b){this.parent=a,this.model=b,this.url=null,this.view=new ConsoleIO.View.Device.Source(this,{name:"Source",guid:this.model.guid,toolbar:[ConsoleIO.Model.DHTMLX.ToolBarItem.Refresh,ConsoleIO.Model.DHTMLX.ToolBarItem.Reload,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.WordWrap,ConsoleIO.Model.DHTMLX.ToolBarItem.SelectAll,ConsoleIO.Model.DHTMLX.ToolBarItem.Copy]}),this.editor=new ConsoleIO.App.Editor(this,{codeMirror:{mode:"javascript"}}),ConsoleIO.Service.Socket.on("device:source:"+this.model.guid,this.add,this)},ConsoleIO.App.Device.Source.prototype.render=function(a){this.view.render(a),this.editor.render(this.view.tab)},ConsoleIO.App.Device.Source.prototype.activate=function(a){a&&ConsoleIO.Settings.reloadTabContentWhenActivated&&this.refresh()},ConsoleIO.App.Device.Source.prototype.add=function(a){this.url=a.url,this.editor.add(a),this.view.setActive()},ConsoleIO.App.Device.Source.prototype.refresh=function(){this.url&&ConsoleIO.Service.Socket.emit("fileSource",{guid:this.model.guid,url:this.url})},ConsoleIO.App.Device.Source.prototype.onButtonClick=function(a,b){this.parent.onButtonClick(this,a,b)||console.log("onButtonClick",a)},ConsoleIO.namespace("ConsoleIO.App.Device.Status"),ConsoleIO.App.Device.Status=function(a,b){this.parent=a,this.model=b,ConsoleIO.Model.DHTMLX.ToolBarItem.DeviceNameText.value=this.model.name,this.view=new ConsoleIO.View.Device.Status(this,{name:"Status",guid:this.model.guid,toolbar:[ConsoleIO.Model.DHTMLX.ToolBarItem.Refresh,ConsoleIO.Model.DHTMLX.ToolBarItem.Reload,ConsoleIO.Model.DHTMLX.ToolBarItem.Web,ConsoleIO.Model.DHTMLX.ToolBarItem.Separator,ConsoleIO.Model.DHTMLX.ToolBarItem.DeviceNameLabel,ConsoleIO.Model.DHTMLX.ToolBarItem.DeviceNameText,ConsoleIO.Model.DHTMLX.ToolBarItem.DeviceNameSet]}),ConsoleIO.Service.Socket.on("device:status:"+this.model.guid,this.add,this),ConsoleIO.Service.Socket.on("device:web:status:"+this.model.guid,this.web,this)},ConsoleIO.App.Device.Status.prototype.render=function(a){this.view.render(a),this.view.setItemState("web",this.model.web.enabled)},ConsoleIO.App.Device.Status.prototype.web=function(a){this.model.web.enabled=a.enabled,this.view.setItemState("web",a.enabled)},ConsoleIO.App.Device.Status.prototype.activate=function(a){a&&ConsoleIO.Settings.reloadTabContentWhenActivated&&this.refresh()},ConsoleIO.App.Device.Status.prototype.add=function(a){this.view.clear(),ConsoleIO.forEachProperty(a,function(a,b){this.view.addLabel(b),ConsoleIO.forEachProperty(a,function(a,c){switch(c.toLowerCase()){case"more":if(a=a.join(", "),!a)return;break;case"search":case"href":a=ConsoleIO.queryParams(a);break;case"cookie":a=ConsoleIO.cookieToJSON(a)}this.view.add(c,"string"==typeof a?a.replace(/"/gim,""):a,b)},this)},this)},ConsoleIO.App.Device.Status.prototype.refresh=function(){ConsoleIO.Service.Socket.emit("deviceStatus",{guid:this.model.guid})},ConsoleIO.App.Device.Status.prototype.onButtonClick=function(a,b){if(!this.parent.onButtonClick(this,a,b))switch(a){case"deviceNameSet":var c=this.view.getValue("deviceNameText");c&&(ConsoleIO.Service.Socket.emit("deviceName",{guid:this.model.guid,name:c}),this.model.name=c,this.parent.update(this.model));break;case"web":this.model.web.enabled!==b&&(this.model.web.enabled=b,ConsoleIO.Service.Socket.emit("webConfig",{guid:this.model.guid,enabled:this.model.web.enabled}))}},ConsoleIO.namespace("ConsoleIO.App.Editor"),ConsoleIO.namespace("ConsoleIO.App.Editor.CopyDocument"),ConsoleIO.App.Editor=function(a,b){var c=this;this.parent=a,this.model=b,this.model.codeMirror=ConsoleIO.extend({mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},readOnly:!0,lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,statementIndent:!0,lineWrapping:!1,styleActiveLine:!0,highlightSelectionMatches:!0,continueComments:"Enter",extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Enter":"submit","Ctrl-Q":"toggleComment","Shift-Ctrl-Q":function(a){c.foldCode(a.getCursor())}},foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]},this.model.codeMirror),this.fileName=null,this.view=new ConsoleIO.View.Editor(this,{guid:this.model.guid,placeholder:this.model.placeholder,toolbar:this.model.toolbar})},ConsoleIO.App.Editor.prototype.render=function(a){this.parent.setTitle&&this.parent.setTitle(this.model.contextId||this.model.guid,this.model.title),this.editor=CodeMirror.fromTextArea(this.view.textArea,this.model.codeMirror),this.view.render(a);var b=this;this.editor.on("change",function(){b.updateButtonState()})},ConsoleIO.App.Editor.prototype.foldCode=function(a){this.editor.foldCode(a,"javascript"===this.model.codeMirror.mode?CodeMirror.braceRangeFinder:CodeMirror.tagRangeFinder)},ConsoleIO.App.Editor.prototype.listScripts=function(a){this.view.listScripts(a)},ConsoleIO.App.Editor.prototype.addScript=function(a){this.view.addScript(a)},ConsoleIO.App.Editor.prototype.getDoc=function(){return this.editor.getDoc()},ConsoleIO.App.Editor.prototype.add=function(a){a.name&&(this.fileName=a.name),this.editor.setValue(a.content.replace(/%20/gim," "))},ConsoleIO.App.Editor.prototype.setOption=function(a,b){this.editor.setOption(a,b)},ConsoleIO.App.Editor.prototype.selectAll=function(){var a=this.getDoc();a.setSelection({line:0,ch:0},{line:a.lineCount(),ch:0})},ConsoleIO.App.Editor.prototype.copy=function(){ConsoleIO.App.Editor.CopyDocument=this.getDoc().getSelection(),this.updateButtonState()},ConsoleIO.App.Editor.prototype.cut=function(){this.copy(),this.editor.replaceSelection(""),this.updateButtonState()},ConsoleIO.App.Editor.prototype.paste=function(){var a=this.getDoc();ConsoleIO.App.Editor.CopyDocument&&(a.somethingSelected()?a.replaceSelection(ConsoleIO.App.Editor.CopyDocument):this.editor.setValue(this.editor.getValue()+ConsoleIO.App.Editor.CopyDocument),a.setCursor({line:a.lineCount(),ch:0})),this.updateButtonState()},ConsoleIO.App.Editor.prototype.undo=function(){this.editor.undo(),this.updateButtonState()},ConsoleIO.App.Editor.prototype.redo=function(){this.editor.redo(),this.updateButtonState()},ConsoleIO.App.Editor.prototype.clear=function(){this.editor.setValue(""),this.getDoc().markClean(),this.fileName=null,this.updateButtonState()},ConsoleIO.App.Editor.prototype.save=function(a){var b=null,c=this.editor.getValue();b=this.fileName?a?prompt("Save file as:",""):this.fileName:prompt("Enter a new file name:",""),null!==b&&ConsoleIO.Service.Socket.emit("saveScript",{content:c,name:b})},ConsoleIO.App.Editor.prototype.command=function(){var a=this.editor.getValue();a&&ConsoleIO.Service.Socket.emit("execute",{guid:this.parent.getActiveDeviceGuid(),code:a})},ConsoleIO.App.Editor.prototype.updateButtonState=function(){if(this.model.toolbar){var a=this.getDoc().historySize();this.view.toggleButton("undo",a.undo>0),this.view.toggleButton("redo",a.redo>0),this.view.toggleButton("save",!this.getDoc().isClean())}},ConsoleIO.App.Editor.prototype.onButtonClick=function(a,b){if(0===a.indexOf("script-"))return ConsoleIO.Service.Socket.emit("loadScript",{name:a.split("-")[1]}),void 0;switch(a){case"cut":this.cut();break;case"copy":this.copy();break;case"paste":this.paste();break;case"selectAll":this.selectAll();break;case"undo":this.undo();break;case"redo":this.redo();break;case"clear":this.clear();break;case"wordwrap":this.setOption("lineWrapping",b);break;case"execute":this.command();break;case"save":this.save(!1);break;case"saveAs":this.save(!0)}},ConsoleIO.namespace("ConsoleIO.App.Manager"),ConsoleIO.App.Manager=function(a,b){this.parent=a,this.model=b,this.activeTab=null,this.store={guid:[],device:[]},this.exportFrame=null,this.view=new ConsoleIO.View.Manager(this,this.model),ConsoleIO.Service.Socket.on("user:subscribed",this.add,this),ConsoleIO.Service.Socket.on("user:unSubscribed",this.remove,this),ConsoleIO.Service.Socket.on("user:exportReady",this.exportReady,this)},ConsoleIO.App.Manager.prototype.render=function(a){this.parent.setTitle(this.model.contextId||this.model.guid,this.model.title),this.view.render(a)},ConsoleIO.App.Manager.prototype.add=function(a){if(-1===this.store.guid.indexOf(a.guid)){this.store.guid.push(a.guid),this.view.add(a.guid,a.name,this.store.guid.length>0);var b=new ConsoleIO.App.Device(this,a);this.store.device.push(b),b.render(this.view.getContextById(a.guid))}},ConsoleIO.App.Manager.prototype.update=function(a){this.store.guid.indexOf(a.guid)>-1&&this.view.update(a.guid,a.name)},ConsoleIO.App.Manager.prototype.remove=function(a){var b=this.store.guid.indexOf(a.guid);b>-1&&(this.store.guid.splice(b,1),this.view.remove(a.guid),this.activeTab===a.guid&&(this.activeTab=this.store.guid[0],this.activeTab&&this.view.setActive(this.activeTab)),ConsoleIO.every(this.store.device,function(b,c){return b.model.guid===a.guid?(this.store.device.splice(c,1),!1):!0},this))},ConsoleIO.App.Manager.prototype.exportReady=function(a){this.exportFrame||(this.exportFrame=ConsoleIO.Service.DHTMLXHelper.createElement({tag:"iframe",target:document.body})),this.exportFrame.src=a.file},ConsoleIO.App.Manager.prototype.close=function(a){ConsoleIO.Service.Socket.emit("unSubscribe",a)},ConsoleIO.App.Manager.prototype.onTabClick=function(a){if(!this.activeTab||this.activeTab!==a){var b;this.activeTab&&(b=this.getDevice(this.activeTab),b&&b.activate(!1)),this.activeTab=a,b=this.getDevice(this.activeTab),b&&b.activate(!0)}},ConsoleIO.App.Manager.prototype.getActiveDeviceGuid=function(){return this.activeTab},ConsoleIO.App.Manager.prototype.getDevice=function(a){var b;return ConsoleIO.every(this.store.device,function(c){return c.model.guid===a?(b=c,!1):!0},this),b},ConsoleIO.namespace("ConsoleIO.Settings"),ConsoleIO.Settings={theme:"web",iconPath:"resources/icons/",reloadTabContentWhenActivated:!0,pageSize:{active:50,list:[50,100,250,500]}},ConsoleIO.namespace("ConsoleIO.Constant.THEMES"),ConsoleIO.namespace("ConsoleIO.Constant.IMAGE_URL"),ConsoleIO.namespace("ConsoleIO.Constant.ICONS"),ConsoleIO.Constant.THEMES={web:{layout:"dhx_skyblue",grid:"dhx_skyblue",win:"dhx_skyblue"},terrace:{layout:"dhx_terrace",grid:"dhx_terrace",win:"dhx_terrace"},get:function(a){return ConsoleIO.Constant.THEMES[ConsoleIO.Settings.theme][a]}},ConsoleIO.Constant.IMAGE_URL={web:{tree:"resources/lib/dhtmlx/web/imgs/csh_vista/",tab:"resources/lib/dhtmlx/web/imgs/",win:"resources/lib/dhtmlx/web/imgs/",grid:"resources/lib/dhtmlx/web/imgs/"},terrace:{tree:"resources/lib/dhtmlx/terrace/imgs/csh_dhx_terrace/",tab:"resources/lib/dhtmlx/terrace/imgs/",win:"resources/lib/dhtmlx/terrace/imgs/",grid:"resources/lib/dhtmlx/terrace/imgs/"},get:function(a){return ConsoleIO.Constant.IMAGE_URL[ConsoleIO.Settings.theme][a]}},ConsoleIO.Constant.ICONS={ONLINE:"online.png",OFFLINE:"offline.png",SUBSCRIBE:"subscribe.gif",VERSION:"version.gif",PC:"pc.png",TV:"tv.jpg",STB:"stb.png",MOBILE:"mobile.png",TABLET:"tablet.png",MEDIA:"media.png",BLUERAY:"blueray.png",CONSOLE:"playstation.png",LG:"lg.png",PHILIPS:"philips.jpg",SAMSUNG:"samsung.jpg",TOSHIBA:"toshiba.png",TESCO:"tesco.jpg",SONY:"sony.jpg",PANASONIC:"panasonic.gif",MICROSOFT:"microsoft.png",MOZILLA:"mozilla.png",GOOGLE:"google.png",APPLE:"apple.png",ANDROID:"android.png","OPERA SOFTWARE":"opera.png",GINGERBREAD:"gingerbread.jpg",CHROME:"chrome.png",IE:"explorer.png",FIREFOX:"firefox.png",OPERA:"opera.png",SAFARI:"safari.png",MAPLE:"maple.gif",NETTV:"nettv.png",NETCAST:"netcast.gif",TOSHIBATP:"toshibatp.png",ESPIAL:"espial.png",MSTAR:"mstar.png",VIERA:"viera.png",PLAYSTATION:"playstation.png",JAVASCRIPT:"javascript.gif",STYLESHEET:"stylesheet.gif",WEB:"web.png",FILE:"",UNKNOWN:"unknown.png",FOLDEROPEN:"../../"+ConsoleIO.Constant.IMAGE_URL.get("tree")+"/folderOpen.gif"},ConsoleIO.ready(function(){ConsoleIO.domReady||(ConsoleIO.domReady=!0,function(a,b){a.commands.autocomplete=function(b){a.showHint(b,a.javascriptHint)},a.commands.submit=function(a){var c=a.getValue();c&&b.Service.Socket.emit("execute",{guid:b.myApp.getActiveDeviceGuid(),code:c})}}(CodeMirror,ConsoleIO),ConsoleIO.Service.Socket.connect(),ConsoleIO.myApp=new ConsoleIO.App,ConsoleIO.myApp.render())});